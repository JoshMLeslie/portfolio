{"version":3,"sources":["./src/app/shared/project-tile/project-tile.module.ts","./src/app/split-screen/web/projects/projects.module.ts","./src/app/split-screen/web/projects/projects.routing.ts","./src/app/split-screen/web/projects/song-to-piano/note-generator.service.ts","./src/app/split-screen/web/projects/song-to-piano/piano-keys.config.ts","./src/app/split-screen/web/projects/song-to-piano/song-to-piano.module.ts","./src/app/split-screen/web/projects/song-to-piano/song-to-piano.service.ts","./src/app/split-screen/web/projects/xr/xr.module.ts"],"names":[],"mappings":"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ACR,EAAE,EAAE,IAAI;IACR,EAAE,EAAE,SAAS;IACb,EAAE,EAAE,IAAI;IACR,EAAE,EAAE,SAAS;IACb,EAAE,EAAE,IAAI;IACR,EAAE,EAAE,SAAS;IACb,EAAE,EAAE,IAAI;IACR,EAAE,EAAE,IAAI;IACR,EAAE,EAAE,SAAS;IACb,EAAE,EAAE,IAAI;IACR,EAAE,EAAE,SAAS;IACb,EAAE,EAAE,IAAI;IACR,EAAE,EAAE,IAAI;IACR,EAAE,EAAE,SAAS;IACb,EAAE,EAAE,IAAI;IACR,EAAE,EAAE,SAAS;IACb,EAAE,EAAE,IAAI;IACR,EAAE,EAAE,SAAS;IACb,EAAE,EAAE,IAAI;IACR,EAAE,EAAE,IAAI;IACR,EAAE,EAAE,SAAS;IACb,EAAE,EAAE,IAAI;IACR,EAAE,EAAE,SAAS;IACb,EAAE,EAAE,IAAI;IACR,EAAE,EAAE,IAAI;IACR,EAAE,EAAE,SAAS;IACb,EAAE,EAAE,IAAI;IACR,EAAE,EAAE,SAAS;IACb,EAAE,EAAE,IAAI;IACR,EAAE,EAAE,SAAS;IACb,EAAE,EAAE,IAAI;IACR,EAAE,EAAE,IAAI;IACR,EAAE,EAAE,SAAS;IACb,EAAE,EAAE,IAAI;IACR,EAAE,EAAE,SAAS;IACb,EAAE,EAAE,IAAI;IACR,EAAE,EAAE,IAAI;IACR,EAAE,EAAE,SAAS;IACb,EAAE,EAAE,IAAI;IACR,EAAE,EAAE,SAAS;IACb,EAAE,EAAE,IAAI;IACR,EAAE,EAAE,SAAS;IACb,EAAE,EAAE,IAAI;IACR,EAAE,EAAE,IAAI;IACR,EAAE,EAAE,SAAS;IACb,EAAE,EAAE,IAAI;IACR,EAAE,EAAE,SAAS;IACb,EAAE,EAAE,IAAI;IACR,EAAE,EAAE,IAAI;IACR,EAAE,EAAE,SAAS;IACb,EAAE,EAAE,IAAI;IACR,EAAE,EAAE,SAAS;IACb,EAAE,EAAE,IAAI;IACR,EAAE,EAAE,SAAS;IACb,EAAE,EAAE,IAAI;IACR,EAAE,EAAE,IAAI;IACR,EAAE,EAAE,SAAS;IACb,EAAE,EAAE,IAAI;IACR,EAAE,EAAE,SAAS;IACb,EAAE,EAAE,IAAI;I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","file":"projects-projects-module-ngfactory-es2015.js","sourcesContent":["import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { CoreModule } from 'app/shared/utilities/core.module';\nimport { ProjectTileComponent } from './project-tile.component';\n\n@NgModule({\n\tdeclarations: [ProjectTileComponent],\n\timports: [\n\t\tCommonModule\n\t\t, CoreModule\n\t],\n\tproviders: [],\n\texports: [ProjectTileComponent]\n})\nexport class ProjecTileModule { }\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { CoreModule } from 'app/shared/utilities/core.module';\nimport { SongToPianoModule } from './song-to-piano/song-to-piano.module';\nimport { WebProjectsComponent } from './projects.component';\nimport { XRModule } from './xr/xr.module';\nimport { ProjecTileModule } from 'app/shared/project-tile/project-tile.module';\nimport { WebProjectsRoutingModule } from './projects.routing';\n\n@NgModule({\n\tdeclarations: [WebProjectsComponent],\n\timports: [\n\t\tCommonModule\n\t\t, WebProjectsRoutingModule\n\t\t, CoreModule\n\t\t, ProjecTileModule\n\t\t, SongToPianoModule\n\t\t, XRModule\n\t],\n\texports: [WebProjectsComponent]\n})\nexport class WebProjectsModule { }\n","import { NgModule } from '@angular/core';\nimport { Routes, RouterModule } from '@angular/router';\nimport { WebProjectsComponent } from './projects.component';\n\nconst routes: Routes = [\n\t// {\n\t// \tpath: '', component: WebProjectsComponent\n\t// }\n];\n\n@NgModule({\n\timports: [RouterModule.forChild(routes)],\n\texports: [RouterModule]\n})\nexport class WebProjectsRoutingModule { }\n","import { Injectable } from '@angular/core';\nimport { BehaviorSubject, timer } from 'rxjs';\nimport { distinctUntilChanged, scan, take } from 'rxjs/operators';\nimport { PIANO_KEYS } from './piano-keys.config';\n\nconst LOGGER = (v: any) => console.log(v);\n\n@Injectable({\n\tprovidedIn: 'root'\n})\nexport class NoteGeneratorService {\n\t/* Work largely done by Chris Wilson (c) 2014 used under The MIT License (MIT) -- https://github.com/cwilso/PitchDetect */\n\n\tprivate _noteList = new BehaviorSubject<string>(''); // tslint:disable-line:variable-name\n\tpublic noteList$ = this._noteList.asObservable().pipe(\n\t\tdistinctUntilChanged()\n\t\t, scan((acc, val) => acc += val + ' ')\n\t); // could also collect it in the BeahaviorSubject, but this way there's less visible code for tracking changes?\n\n\tisPlaying = false;\n\n\tbuflen = 256;\n\tbuf = new Float32Array(this.buflen);\n\tMIN_SAMPLES = 0;\n\tGOOD_ENOUGH_CORRELATION = 0.95; // this is the \"bar\" for how close a correlation needs to be\n\tresolution: 100; // miliseconds between reads / updates\n\tMAX_SIZE: number;\n\taudioContext: AudioContext = new AudioContext();\n\tanalyser: AnalyserNode;\n\tmediaStreamSource: MediaStreamAudioSourceNode;\n\n\tconstructor() {\n\t\tthis.MAX_SIZE = Math.max(4, Math.floor(this.audioContext.sampleRate / 5000)); \t// corresponds to a 5kHz signal\n\t}\n\n\tpublic toggleLiveInput() {\n\t\tif (this.isPlaying) {\n\t\t\tthis.stopPlaying();\n\t\t\treturn;\n\t\t}\n\n\t\tconst audioOptions = { audio: { advanced: [\n\t\t\t{ echoCancellation: false },\n\t\t\t{ autoGainControl: false },\n\t\t\t{ noiseSuppression: false },\n\t\t]}};\n\n\t\tnavigator.mediaDevices.getUserMedia(audioOptions).then(stream => {\n\t\t\t// Create an AudioNode from the stream.\n\t\t\tthis.mediaStreamSource = this.audioContext.createMediaStreamSource(stream);\n\t\t\t// Connect it to the destination.\n\t\t\tthis.analyser = this.audioContext.createAnalyser();\n\t\t\tthis.analyser.fftSize = 512;\n\t\t\tthis.mediaStreamSource.connect(this.analyser);\n\t\t\tthis.updatePitch();\n\n\t\t\tthis.startPlaying();\n\t\t})\n\t\t.catch(e => {\n\t\t\talert(e);\n\t\t\tthis.stopPlaying();\n\t\t});\n\t}\n\n\tprivate stopPlaying() {\n\t\tthis.isPlaying = false;\n\t\tthis.audioContext.suspend().then(LOGGER, LOGGER).catch(LOGGER);\n\t}\n\tprivate startPlaying() {\n\t\tthis.isPlaying = true;\n\t\tthis.audioContext.resume().then(LOGGER, LOGGER).catch(LOGGER);\n\t}\n\n\tprivate autoCorrelate() {\n\t\tconst sampleRate = this.audioContext.sampleRate;\n\t\tconst SIZE = this.buflen;\n\t\tconst MAX_SAMPLES = Math.floor(this.buflen / 2);\n\t\tconst correlations = {};\n\t\tlet bestOffset = -1;\n\t\tlet bestCorrelation = 0;\n\t\tlet rms = 0;\n\t\tlet foundGoodCorrelation = false;\n\t\tlet lastCorrelation = 1;\n\n\t\tfor (let i = 0; i < SIZE; i++) {\n\t\t\tconst val = this.buf[i];\n\t\t\trms += val * val;\n\t\t}\n\n\t\trms = Math.sqrt(rms / SIZE);\n\n\t\t// not enough signal\n\t\tif (rms < 0.01) { return -1; }\n\n\t\tfor (let offset = this.MIN_SAMPLES; offset < MAX_SAMPLES; offset++) {\n\t\t\tlet correlation = 0;\n\n\t\t\tfor (let i = 0; i < MAX_SAMPLES; i++) {\n\t\t\t\tcorrelation += Math.abs((this.buf[i]) - (this.buf[i + offset]));\n\t\t\t}\n\n\t\t\tcorrelations[offset] = 1 - (correlation / MAX_SAMPLES); // store it, for the tweaking we need to do below.\n\n\t\t\tif ((correlation > this.GOOD_ENOUGH_CORRELATION) && (correlation > lastCorrelation)) {\n\t\t\t\tfoundGoodCorrelation = true;\n\t\t\t\tif (correlation > bestCorrelation) {\n\t\t\t\t\tbestCorrelation = correlation;\n\t\t\t\t\tbestOffset = offset;\n\t\t\t\t}\n\t\t\t} else if (foundGoodCorrelation) {\n\t\t\t\t/**\n\t\t\t\t * short-circuit - A good correlation was found, then a bad one.\n\t\t\t\t * Without this catch, you'd see duplicates.\n\t\t\t\t *\n\t\t\t\t * Now we need to tweak the offset - by interpolating between the values to the left and right of the\n\t\t\t\t * best offset, and shifting it.\n\t\t\t\t *\n\t\t\t\t * This is complex, and HACKY in this code (happy to take PRs!) -\n\t\t\t\t * we need to do a curve fit on correlations around best_offset in order to better determine precise\n\t\t\t\t * (anti-aliased) offset.\n\t\t\t\t *\n\t\t\t\t * best_offset >=1\n\t\t\t\t * and since foundGoodCorrelation cannot go to true until the second pass (offset=1)\n\t\t\t\t * and we can't drop into this clause until the following pass (else if).\n\t\t\t\t */\n\t\t\t\tconst shift = (correlations[bestOffset + 1] - correlations[bestOffset - 1]) / correlations[bestOffset];\n\t\t\t\treturn sampleRate / (bestOffset + (8 * shift));\n\t\t\t}\n\t\t\tlastCorrelation = correlation;\n\t\t}\n\n\t\treturn bestCorrelation > 0.01 ? sampleRate / bestOffset : -1;\n\t}\n\n\tprivate updatePitch() {\n\t\tthis.analyser.getFloatTimeDomainData(this.buf);\n\t\tconst pitch = this.autoCorrelate();\n\n\t\tif (pitch !== -1) {\n\t\t\tthis.printNote(pitch);\n\t\t}\n\t\ttimer(this.resolution).pipe(take(1)).subscribe(() => this.updatePitch());\n\t}\n\n\tprivate printNote(pitch: number) {\n\t\tconst pianoKey = Math.floor(12 * Math.log2(pitch / 440) + 49);\n\t\tconst noteEl = PIANO_KEYS[pianoKey];\n\n\t\tthis._noteList.next(noteEl);\n\t}\n}\n","export const PIANO_KEYS = {\n\t88: 'C8',\n\t87:\t'B7 \t',\n\t86:\t'A♯7/B♭7',\n\t85:\t'A7',\n\t84:\t'G♯7/A♭7',\n\t83:\t'G7',\n\t82:\t'F♯7/G♭7',\n\t81:\t'F7',\n\t80:\t'E7',\n\t79:\t'D♯7/E♭7',\n\t78:\t'D7',\n\t77:\t'C♯7/D♭7',\n\t76:\t'C7',\n\t75:\t'B6',\n\t74:\t'A♯6/B♭6',\n\t73:\t'A6',\n\t72:\t'G♯6/A♭6',\n\t71:\t'G6',\n\t70:\t'F♯6/G♭6',\n\t69:\t'F6',\n\t68:\t'E6',\n\t67:\t'D♯6/E♭6',\n\t66:\t'D6',\n\t65:\t'C♯6/D♭6',\n\t64:\t'C6',\n\t63:\t'B5',\n\t62:\t'A♯5/B♭5',\n\t61:\t'A5',\n\t60:\t'G♯5/A♭5',\n\t59:\t'G5',\n\t58:\t'F♯5/G♭5',\n\t57:\t'F5',\n\t56:\t'E5',\n\t55:\t'D♯5/E♭5',\n\t54:\t'D5',\n\t53:\t'C♯5/D♭5',\n\t52:\t'C5',\n\t51:\t'B4',\n\t50:\t'A♯4/B♭4',\n\t49:\t'A4', // A440 -- middle\n\t48:\t'G♯4/A♭4',\n\t47:\t'G4',\n\t46:\t'F♯4/G♭4',\n\t45:\t'F4',\n\t44:\t'E4',\n\t43:\t'D♯4/E♭4',\n\t42:\t'D4',\n\t41:\t'C♯4/D♭4',\n\t40:\t'C4',\n\t39:\t'B3',\n\t38:\t'A♯3/B♭3',\n\t37:\t'A3',\n\t36:\t'G♯3/A♭3',\n\t35:\t'G3',\n\t34:\t'F♯3/G♭3',\n\t33:\t'F3',\n\t32:\t'E3',\n\t31:\t'D♯3/E♭3',\n\t30:\t'D3',\n\t29:\t'C♯3/D♭3',\n\t28:\t'C3',\n\t27:\t'B2',\n\t26:\t'A♯2/B♭2',\n\t25:\t'A2',\n\t24:\t'G♯2/A♭2',\n\t23:\t'G2',\n\t22:\t'F♯2/G♭2',\n\t21:\t'F2',\n\t20:\t'E2',\n\t19:\t'D♯2/E♭2',\n\t18:\t'D2',\n\t17:\t'C♯2/D♭2',\n\t16:\t'C2',\n\t15:\t'B1',\n\t14:\t'A♯1/B♭1',\n\t12:\t'G♯1/A♭1',\n\t11:\t'G1',\n\t9:\t'F1',\n\t7:\t'D♯1/E♭1',\n\t5:\t'C♯1/D♭1',\n\t4:\t'C1',\n\t3:\t'B0',\n\t2:\t'A♯0/B♭0',\n\t1:  'A0;'\n};\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { SongToPianoComponent } from './component/song-to-piano.component';\nimport { SongToPianoService } from './song-to-piano.service';\nimport { NoteGeneratorService } from './note-generator.service';\nimport { CoreModule } from 'app/shared/utilities/core.module';\n\n@NgModule({\n\tdeclarations: [SongToPianoComponent],\n\tproviders: [\n\t\tSongToPianoService\n\t\t, NoteGeneratorService\n\t],\n\timports: [\n\t\tCommonModule\n\t\t, CoreModule\n\t],\n\texports: [SongToPianoComponent]\n})\nexport class SongToPianoModule { }\n","import { Injectable } from '@angular/core';\nimport { WindowService } from '../../../../shared/utilities/window.service';\n\n/** Source: https://stackoverflow.com/a/27852403 */\n@Injectable({\n\tprovidedIn: 'root'\n})\nexport class SongToPianoService {\n\n\tpublic gainNode = null;\n\n\tprivate audioContext = new AudioContext();\n\tprivate BUFF_SIZE = 16384;\n\tprivate microphoneStream = null;\n\tprivate scriptProcessorNode = null;\n\tprivate scriptProcessorFFTNode = null;\n\tprivate analyserNode = null;\n\tprivate navigator: Navigator;\n\n\tconstructor(window: WindowService) {\n\t\tthis.navigator = window.navigator;\n\n\t}\n\n\twebaudioToolingObj() {\n\t\tconsole.log('audio is starting up ...');\n\n\t\tconst getUserMedia = this.navigator.mediaDevices.getUserMedia;\n\n\t\tif (getUserMedia) {\n\t\t\tconst opts: MediaStreamConstraints = {audio: true};\n\t\t\tthis.navigator.mediaDevices.getUserMedia(opts)\n\t\t\t\t.then((stream) => {\n\t\t\t\t\tconsole.log(stream);\n\t\t\t\t\tthis.startMicrophone(stream);\n\t\t\t\t})\n\t\t\t\t.catch((e) => {\n\t\t\t\t\tconsole.error(e);\n\t\t\t\t\talert('Error capturing audio.');\n\t\t\t\t});\n\t\t} else {\n\t\t\talert('getUserMedia not supported in this browser.');\n\t\t}\n\t}\n\n\tstartMicrophone(stream) {\n\t\tthis.gainNode = this.audioContext.createGain();\n\t\tthis.gainNode.connect(this.audioContext.destination);\n\n\t\tthis.microphoneStream = this.audioContext.createMediaStreamSource(stream);\n\t\tthis.microphoneStream.connect(this.gainNode);\n\n\t\tthis.scriptProcessorNode = this.audioContext.createScriptProcessor(this.BUFF_SIZE, 1, 1);\n\n\t\tthis.microphoneStream.connect(this.scriptProcessorNode);\n\n\t\t// --- setup FFT\n\t\tthis.scriptProcessorFFTNode = this.audioContext.createScriptProcessor(2048, 1, 1);\n\t\tthis.scriptProcessorFFTNode.connect(this.gainNode);\n\n\t\tthis.analyserNode = this.audioContext.createAnalyser();\n\t\tthis.analyserNode.smoothingTimeConstant = 0;\n\t\tthis.analyserNode.fftSize = 2048;\n\n\t\tthis.microphoneStream.connect(this.analyserNode);\n\n\t\tthis.analyserNode.connect(this.scriptProcessorFFTNode);\n\n\t\tthis.scriptProcessorFFTNode.onaudioprocess = () => {\n\t\t\t// get the average for the first channel\n\t\t\tconst arr = new Uint8Array(this.analyserNode.frequencyBinCount);\n\t\t\tthis.analyserNode.getByteFrequencyData(arr);\n\t\t};\n\t}\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { XrComponent } from './xr.component';\nimport { CoreModule } from 'app/shared/utilities/core.module';\n\n@NgModule({\n\tdeclarations: [XrComponent],\n\timports: [\n\t\tCommonModule\n\t\t, CoreModule\n\t],\n\texports: [XrComponent]\n})\nexport class XRModule { }\n"],"sourceRoot":"webpack:///"}